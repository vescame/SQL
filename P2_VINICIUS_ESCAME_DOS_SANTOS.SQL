-- Prova Par
-- Nome: Vinicius Escame dos Santos
-- Status da atividade: Funcionando

/*
CRIAR TRIGGER PARA LIMITAR A INCLUSAO DE HORARIO PARA TURMAS CUJO PROFESSOR
TENHA UM TITULO DE NOME 'ESPECIALISTA'. UTILIZE PELO MENOS UM NATURAL JOIN.
*/

CREATE OR REPLACE TRIGGER TR_LIMITA_HORARIO
BEFORE UPDATE OR INSERT ON HORARIO
FOR EACH ROW
ENABLE
DECLARE
  V_TITULO VARCHAR(35);
BEGIN

  SELECT DISTINCT UPPER(NOMETIT)
    INTO V_TITULO
    FROM PROFTURMA
 NATURAL JOIN PROFESSOR
 NATURAL JOIN TITULACAO WHERE NUMDISC = :NEW.NUMDISC;

  IF V_TITULO = 'ESPECIALISTA' THEN
      RAISE_APPLICATION_ERROR(-20000, 'Nao podemos inserir horarios em que o professor e especialista');
   END IF;
   EXCEPTION
      WHEN NO_DATA_FOUND THEN
      DBMS_OUTPUT.PUT_LINE('insercao permitida');
END;
/